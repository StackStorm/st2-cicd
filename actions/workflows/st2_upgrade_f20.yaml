---
  chain:
    -
      name: "upgrade_st2"
      ref: "core.remote_sudo"
      params:
        hosts: "{{hostname}}"
        cmd: "yum install -y st2common st2reactor st2actions st2api st2auth st2client"
      on-success: "restart_st2"
    -
      name: "restart_st2"
      ref: "core.remote_sudo"
      params:
        hosts: "{{hostname}}"
        cmd: "st2ctl reload &> /dev/null && nohup bg st2ctl restart &> /dev/null; sleep 20"
        # cmd: "st2ctl reload && nohup bg st2ctl restart; sleep 20" 
      on-success: "action_run"
    -
      name: "action_run"
      ref: "st2cd.action_run"
      params:
        hosts: "{{hostname}}"
        name: "core.local-date"
        action: "{{action}}"
        params: "{{action_params}}"

  default: "upgrade_st2"
