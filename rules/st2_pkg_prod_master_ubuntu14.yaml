---
    name: "st2_pkg_prod_master_ubuntu14"
    description: "Build st2 packages after tests succeed and push them to production"
    enabled: true
    trigger:
        type: "core.st2.generic.actiontrigger"
    criteria:
        trigger.action_name:
            pattern: "st2cd.integration_tests"
            type: "equals"
        trigger.status:
            pattern: "succeeded"
            type: "equals"
        trigger.parameters.branch:
            pattern: "master"
            type: "equals"
        trigger.parameters.environment:
            pattern: "staging"
            type: "equals"
        trigger.parameters.hostname:
            pattern: "{% set host_key = ['st2_stage_', trigger.parameters.branch, '_UBUNTU14']|join %}{{system[host_key]}}"
            type: "equals"
    action:
        ref: "st2cd.st2_pkg_ubuntu14"
        parameters:
            repo: "{{trigger.parameters.repo}}"
            branch: "{{trigger.parameters.branch}}"
            dl_server: "{{system.apt_origin_production}}"
            environment: "production"
            revision: "{{trigger.parameters.revision}}"
            build: "{{trigger.parameters.build}}"
