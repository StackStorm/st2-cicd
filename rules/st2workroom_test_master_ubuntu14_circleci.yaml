---
    name: "st2workroom_test_master_ubuntu14_circleci"
    description: "Test st2workroom on each circle ci pkg build"
    pack: "st2cd"
    enabled: true
    trigger:
        type: "core.st2.generic.actiontrigger"
    criteria:
        trigger.action_name:
            pattern: "st2cd.circle_ci_packages_poller"
            type: "equals"
        trigger.status:
            pattern: "succeeded"
            type: "equals"
        trigger.parameters.environment:
            pattern: "staging"
            type: "equals"
        trigger.parameters.st2_branch:
            pattern: "master"
            type: "equals"
    action:
        ref: "st2cd.st2workroom_test"
        parameters:
            hostname: "st2w-{{trigger.parameters.st2_branch}}-u14-{{trigger.execution_id | truncate(10, False, '')}}"
            build: "{{trigger.parameters.build}}"  # should be read from result (build number)
            version: "{{system.st2_unstable_version}}"
            environment: "sandbox"
            branch: "{{trigger.parameters.st2_branch}}"
            revision: "{{trigger.parameters.st2_revision}}"
            repo: "{{trigger.parameters.st2_repo}}"
            distro: "UBUNTU14"
            pkg_st2: true
            install_url: "https://stackstorm.com/install.sh"
